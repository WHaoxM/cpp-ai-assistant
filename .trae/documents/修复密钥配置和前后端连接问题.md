## 修复计划

### 问题1：始终显示没配置密钥的问题
**根本原因**：在`callAIModel`函数中，API密钥检查是在处理自定义模型之前进行的，导致即使自定义模型配置了API密钥，函数仍然会抛出"未配置API密钥"的错误。

**修复方案**：将API密钥检查移到自定义模型处理之后，确保在检查密钥之前已经正确设置了自定义模型的API密钥。

**修改文件**：`src/services/aiService.js`

### 问题2：前端无法与后端连接的问题
**根本原因**：前端直接调用AI API，而不是通过后端服务，导致跨域问题和浏览器安全限制。

**修复方案**：修改`callAIModel`函数，使其通过后端`/api/ai-model`端点调用AI模型，而不是直接从浏览器调用。

**修改文件**：`src/services/aiService.js`

## 具体修复步骤

1. **修复密钥配置检查问题**
   - 在`callAIModel`函数中，将API密钥检查移到自定义模型处理之后
   - 确保在检查密钥之前已经正确设置了自定义模型的API密钥

2. **修复前端与后端连接问题**
   - 修改`callAIModel`函数，使其通过后端`/api/ai-model`端点调用AI模型
   - 移除直接调用AI API的代码，统一通过后端服务调用
   - 确保请求格式与后端API一致

## 预期效果

1. 使用自定义模型时，能够正确识别和使用自定义模型的API密钥，不再显示"未配置API密钥"的错误
2. 前端通过后端服务调用AI模型，避免跨域问题和浏览器安全限制
3. API密钥不再暴露在浏览器中，提高安全性
4. 统一通过后端服务处理AI模型调用，便于后续扩展和维护